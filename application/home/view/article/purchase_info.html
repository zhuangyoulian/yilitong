<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name=”viewport” content=”width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes” />
    <meta http-equiv=”X-UA-Compatible” content=”IE=edge,chrome=1″/>
    <meta name="keywords" content="{$config['shop_info_store_keyword']}">
    <meta name="description" content="{$config['shop_info_store_desc']}">
    <link rel="shortcut icon" type="image/x-icon" href="__PUBLIC__/images/favicon.ico" media="screen"/>
    <title>企业采集</title>
</head>
<style>
    .err{color:#F00; display:none;}
    .ui-tooltip{
        display:none;
        display:none !important;
    }
  .input-txt1{
    margin-right:2px;
    width: 100px !important;
}
  .shan{
    width:20p;
    height:20px
    line-height:20;
    text-align:center;
    border:1px solid #aaa;
    color:#f00;
   
    float:right;
  }
  .tabletr thead tr{
   
    height:30px;
  }
   
  .tabletr tbody tr{
   
    height:30px;
  }
  #tableid  tr{
   height:30px;
  }
  .ncap-form-default dt.tit, .ncap-form-default dd.opt {
    font-size: 16px!important;
    line-height: 24px;
    vertical-align: top;
    letter-spacing: normal;
    display: inline-block;
}
  H1{color:#0099ff;}
  input, textarea, select, button {
    color: #555;
    font-size: 16px!important;
    font-family: "Microsoft Yahei", "Lucida Grande", Verdana, Lucida, Helvetica, Arial, sans-serif;
}
  .ncap-form-default dl.row:nth-child(even), .ncap-form-all dd.opt:nth-child(even) {
    background-color: #fff !important
}
main.css:952
.ncap-form-default dl.row, .ncap-form-all dd.opt {
    font-size: 0;
    color: #777;
    background-color: #FFF;
    padding: 12px 0;
    margin-top: 0px!important;
    border-style: solid;
    border-width:  0 !important;
   
    position: relative;
    z-index: 1;
}
  .ncap-form-default dl.row, .ncap-form-all dd.opt {
    font-size: 0;
    color: #777;
    background-color: #FFF;
    padding: 12px 0;
    margin-top: -1px;
    border-style: solid;
    border-width: 0  !important;
    border-color: #F0F0F0;
    position: relative;
    z-index: 1;
}
 
</style>
 <include file="public/header" /> 
  <include file="public/layout" />
<script src="__ROOT__/public/static/js/layer/laydate/laydate.js"></script>
<link rel="stylesheet" href="__BUSINESS__/style/quoted.css" type="text/css">
<!-- 省市区插件 -->
<link rel="shortcut icon" href="favicon.ico" />
<link rel="stylesheet" href="__PUBLIC__/static/css/index.css" type="text/css">
<link rel="stylesheet" href="__PUBLIC__/js/apply_one.css" />

<body style="background-color: rgb(253, 253, 253); overflow: auto;">
 
<div style="width:1200px;margin:0 auto;" >  
<div id="toolTipLayer" style="position: absolute; z-index: 9999; display: none; visibility: visible; left: 95px; top: 573px;"></div>
<div id="append_parent"></div>
<div id="ajaxwaitid"></div>

<div class="page">
   <!-- <div class="fixed-bar">
        <div class="item-title"><a class="back" href="javascript:history.back();" title="返回列表"><i class="fa fa-arrow-circle-o-left"></i></a>
            <div class="subject">
                <h3>企业采购 - 编辑采集</h3>
                <h5>网站系统企业采购采集详情页</h5>
            </div>
        </div>
    </div>-->

    <form class="form-horizontal" id="handleposition" method="post">
        <h1>基本信息</h1>
        <input type="hidden" name="id" value="{$info.id}">
        <div class="ncap-form-default">
            
            <dl class="row">
                <dt class="tit">
                    <label>公司名称</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="company_name" id="company_name" value="{$supplier.company_name}" class="input-txt" placeholder="请填写公司名称">
                    <span class="err" id="err_company_name"></span>
                <!--    <p class="notic">请填写公司名称</p>-->
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label><em>*</em>采购标题</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="title" id="title" value="" class="input-txt" placeholder="请填写采购标题">
                    <span class="err" id="err_title"></span>
                 <!--  <p class="notic">请填写采购标题</p>--> 
                </dd>
            </dl>
          <dl class="row">
                <dt class="tit">
                    <label><em></em>预算</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="budget" id="budget" value="" class="input-txt" placeholder="请填写预算">
                    <span class="err" id="err_title"></span>
                   <!--<p class="notic">请填写预算</p>--> 
                </dd>
            </dl>
              <dl class="row">
                <dt class="tit">
                  <label>是否定制</label>
                </dt>
                <dd class="opt">
                  <div class="onoff">
                    <label for="sustomized1" class="cb-enable ">是</label>
                    <label for="sustomized0" class="cb-disable selected">否</label>
                    <input id="sustomized1" name="sustomized" value="1" type="radio" />
                    <input id="sustomized0" name="sustomized" value="0" type="radio"  checked="checked"/>
                  </div>
                  <p class="notic"></p>
                </dd>
            </dl> 
  <dl class="row">
                <dt class="tit">
                    <label for="articleForm"><em>*</em>询价时间</label>
                </dt>
                <dd class="opt">
                    <input type="text" id="inquiry_time" name="inquiry_time" value=""  class="input-txt" placeholder="询价时间">
                    <span class="err" id="err_inquiry_time"></span>
                  <!-- <p class="notic">询价时间</p>--> 
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label for="articleForm"><em>*</em>截止时间</label>
                </dt>
                <dd class="opt">
                    <input type="text" id="dead_time" name="dead_time" value="" class="input-txt" placeholder="截止时间">
                    <span class="err" id="err_dead_time"></span>
                 <!--  <p class="notic">截止时间</p>--> 
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label for="articleForm"><em>*</em>期望收货时间</label>
                </dt>
                <dd class="opt">
                    <input type="text" id="expect_time" name="expect_time" value="" class="input-txt" placeholder="期望收货时间">
                    <span class="add-on input-group-addon"></span>
                  <!--  <p class="notic">期望收货时间</p>-->
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label><em>*</em>联系人</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="contacts_name" id="contacts_name" value="{$supplier.contacts_name}" class="input-txt" placeholder="请填写联系人">
                    <span class="err" id="err_contacts_name"></span>
                 <!--   <p class="notic">请填写联系人</p>-->
                </dd>
            </dl>

            <dl class="row">
                <dt class="tit">
                    <label><em>*</em>联系电话</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="tel" id="tel" value="{$supplier.contacts_phone}" class="input-txt" placeholder="请填写联系手机电话">
                    <span class="err" id="err_tel"></span>
               <!--    <p class="notic">请填写联系手机电话</p>--> 
                </dd>
            </dl>     
            <dl class="row">
                <dt class="tit">
                  <label for="ac_name"><em>*</em>收货地址</label>
                </dt>
                <dd class="opt">
                  <input type="text" class="input-txt city-tab" id="city" name="address" value="" placeholder="省--市--区">
                  <span  class="info-tips"  style="color:#F00; display:none;"></span>
                  <p class="notic">省--市--区</p>
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label for="ac_name">供应商所在地区</label>
                </dt>
                <dd class="opt">
                    <input type="text" class="input-txt" name="region" value="" placeholder="默认-全国，如广东,上海,天津,湖南,海南,青海等">

                        <p class="notic">请输入要求供应商所在省份</p>
                      </dd>
                   </dl>
        </div>
  <div class="ncap-form-default">
    <h1>项目礼品采购清单</h1><br>
    <table style="width:10px;float:left;margin-right: 5px" id="tableid" class="tabcut">
     <thead> <tr><td></td></tr></thead>
      <tbody>
      <tr><td name=0 style="height: 30px;line-height: 30px;"><span onClick=yu(0); style="display:block;height:30px;width:20px;color: #f20;cursor: pointer; font-size: 20px;padding: 0px 5px;line-height: 30px">—</span></td></tr>
      </tbody>
    </table>
    <table border="1" class="tabletr" style='float:left;'>
      <thead>
<tr>
  
<td style="width:100px;">序号</td>
<td  style="width:100px;"><span style="color:#f00">*</span>产品名称</td>
 
  <td  style="width:100px;">规格</td>
  <td  style="width:100px;">颜色</td>
  <td  style="width:100px;">品牌</td>
  <td  style="width:100px;"><span style="color:#f00">*</span>单位</td>
  <td  style="width:100px;"><span style="color:#f00">*</span>数量</td>
  <td  style="width:200px;">备注</td>
</tr>
        
        
        </thead>
         <tbody id="tbodytr">
           <tr>
           
  <td ><input name="goods_number[]" style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" /></td>
  <td><input  name="goods_name[]"   style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;"  /></td>
  <td><input  name="goods_norm[]"  style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;"  /></td>
  <td><input  name="goods_color[]" style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;"  /></td>
  <td><input  name="goods_brand[]" style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" /></td>
  <td><input  name="goods_unit[]" style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;"  /></td>
  <td><input  name="goods_num[]" style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" /></td>
  <td><input name="goods_remarks[]" style="width:170px; border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" /></td>
              </tr>
            </tbody>
      <tfoot>
        <tr><td colspan="10" style="text-align:center;color:#0099ff" id="addtr">+添加产品</td></tr>
      </tfoot>
</table>
    
    <table style="float:left;width:180px;"  id="tableid1">
       <thead>
         <tr>
  
          <td style="width:150px;height:30px;">图片</td>
         </tr>
      </thead>
       <tbody>
         <tr>
           <td style="height:30px;">
           <dd class="opt">
          <div class="input-file-show" id="divComUploadContainer">
            <span class="show">
              <a id="img_as" class="nyroModal" rel="gal" href="{$goods_category_info.image}">
                  <i id="img_is" class="fa fa-picture-o" onmouseover="layer.tips('<img src={$goods_category_info.icon}>',this,{tips: [1, '#fff']});" onmouseout="layer.closeAll();"></i>
              </a>
            </span>
              <span class="type-file-box" style="width:150px;">
            <input type="text" id="imagetext" name="goods_img[]" value="" class="type-file-text" style="width:50px;"/>
            <input type="button" class="type-file-button" onClick="GetUploadify(1,'imagetext','purchaseList','img_call_back')" value="上传图片" hidefocus="true" nc_type="change_site_logo" title="点击前方预览图可查看大图，点击按钮选择文件并提交表单后上传生效"/>
            </span>
          </div>
        </dd>
           </td>
         </tr>
      </tbody>
    </table>
  </div>
  <div class="ncap-form-default"> 
    <p>报价要求</p>
    <textarea style="height:100px;width:99%;" name="quote_ask" >
    </textarea>
  </div>
   <div class="ncap-form-default"> 
    <p>补充详细资料</p>
    <textarea style="height:100px;width:99%;" name="description" placeholder="请补充详细资料...">
    </textarea>
     <p>+添加附件</p>
  </div>
   <div class="ncap-form-default"> 
     <!-- <div style="float:left;height:36px;line-height:36px;width:80px;display:block;text-align:center;background:#eee;margin-top:10px;margin-left:40%;" onclick="preview()">预览</div> -->
  <div class="bot" ><a onclick="verifyForm()" class="ncap-btn-big ncap-btn-green">确认提交</a></div>
  </div> 
    </form>
</div>
</div>

<script src="__PUBLIC__/js/Popt.js"></script>
<script src="__PUBLIC__/js/cityJson.js"></script>
<script src="__PUBLIC__/js/citySet.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
        $('#inquiry_time').layDate();
        $('#dead_time').layDate();
        $('#expect_time').layDate();

        $("#city").focus(function(e){
            SelCity(this,e);
            //alert(this);exit;
            console.log("inout",$(this).val(),new Date())
        });
    })
</script>

<script type="text/javascript">



    function verifyForm(){
        
       var  divin=$('#optinput').children('div').length;
       var lengthi=divin*6;
       var id=[];
       while (i<lengthi)       
      {  
          if(($("#id"+i+"").val())=="")           
          {  id[i]=i;         }
        i=i+1;     
      }
      var goodsName=[];
      var goodsNum=[];
      var goodsUnit=[];
      for(var j=0;j<$("#tbodytr tr").length;j++){
        if($("#tbodytr tr").eq(j).find("input[name='goods_name[]']").val()!=''){
         goodsName[j]=$("#tbodytr tr").eq(j).find("input[name='goods_name[]']").val();
        }
        if($("#tbodytr tr").eq(j).find("input[name='goods_num[]']").val()!=''){
           goodsNum[j]=$("#tbodytr tr").eq(j).find("input[name='goods_num[]']").val();
        }
        if($("#tbodytr tr").eq(j).find("input[name='goods_unit[]']").val()!=''){
          goodsUnit[j]=$("#tbodytr tr").eq(j).find("input[name='goods_unit[]']").val();
        }
      }
      if(goodsName.length!=goodsUnit.length||goodsUnit.length!=goodsNum.length){
          layer.alert("请填写完整商品信息！");
          return false;
      }
      var names=clear_arr_trim(goodsName);
      var nums=clear_arr_trim(goodsNum);
      var units=clear_arr_trim(goodsUnit);
      if( names.length<1||nums.length<1||units.length<1){
          layer.alert("请至少填入一种商品！");
          return false;
      }
      if(names.length!=nums.length||units.length!=nums.length){
          layer.alert("请填写完整商品信息！");
          return false;
      }
      
      
      if(id.length>0){
            //alert("请填写文章标题！");
            layer.alert("请填写完整商品！");
            return false;
        }       

        if($('input[name="title"]').val() == ''){
            //alert("请填写文章标题！");
            layer.alert("请填写采购标题！");
            return false;
        }       
        if($('#contacts_name').val() == '' ){
            layer.alert("请输入联系人");
            return false;
        }
        if($('#tel').val() == '' ){
            layer.alert("请输入联系电话");
            return false;
        }
       /* if($('#goods_name').val() == '' ){
            layer.alert("请输入采购商品");
            return false;
        }
        if($('#goods_count').val() == '' ){
            layer.alert("请输入商品数量");
            return false;
        }*/
        if($('#inquiry_time').val() == '' ){
            layer.alert("请输入询价时间");
            return false;
        }
        if($('#dead_time').val() == '' ){
            layer.alert("请输入截止时间");
            return false;
        }
        if($('#expect_time').val() == '' ){
            layer.alert("请输入期望时间");
            return false;
        }
        if($('#address').val() == '' ){
            layer.alert("请输入地址");
            return false;
        }


        $('span.err').hide();
        $.ajax({
            type: "POST",
            //成功提交后数据保存的路径
            url: "{:Url('Home/Article/add_purchase')}",
            data: $('#handleposition').serialize(),
            dataType: "json",
            error: function () {
                layer.alert("服务器繁忙, 请联系管理员!");
            },
            success: function (data) {
                if (data.status== 1) {
                    layer.msg(data.msg, {
                        icon: 1,
                        time: 1000
                    }, function(){
                        //成功提交后页面跳转的路径
                        window.parent.location.href= "{:Url('Supplier/Index/index')}";
                        //top.location.href = "{:Url('Supplier/Purchase/purchase_list')}";
                    });
                } else {
                    layer.msg(data.msg, {icon: 2,time: 1000});
                    $.each(data.result, function (index, item) {
                        $('#err_' + index).text(item).show();
                    });
                }
            }
        });
    }
     var item=1;
     $("#addtr").click(function(){
       var leng1= $("#tbodytr").children("tr").length;
       var leng=leng1-1;
       var html='<tr id="right'+item+'"><td ><input style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_number[]"/></td><td><input  style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_name[]"/></td><td><input  style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_norm[]" /></td><td><input  style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_color[]" /></td><td><input   style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_brand[]"/></td><td><input  style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;"  name="goods_unit[]"/></td><td><input  style="width:70px;border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_num[]"/></td><td><input style="width:170px; border:1px solid #eee;height: 20px;line-height: 20px;border-radius: 4px;" name="goods_remarks[]" /></td></tr>';

       var html1='<tr id="left'+item+'" style="height: 30px;line-height: 30px;"><td><span onclick="yu('+item+')" style="display:block;height:30px;width:20px;color: #f20;cursor: pointer; font-size: 20px;padding: 0px 5px;line-height: 30px">—</span></td></tr>';

       var funct='GetUploadify(1,"imagetext'+item+'","purchaseList","img_call_back_index")';

       var html2='<tr id="mid'+item+'"><td style="height:30px;"><dd class="opt"><div class="input-file-show" id="divComUploadContainer'+item+'"><span class="show"><a id="img_as'+item+'" class="nyroModal" rel="gal" ><i id="img_is'+item+'" class="fa fa-picture-o" onmouseout="layer.closeAll();"></i></a></span><span class="type-file-box" style="width:150px;"><input type="text" id="imagetext'+item+'" name="goods_img[]" value="" class="type-file-text" style="width:50px;"/> <input type="button" class="type-file-button" onClick='+funct+' value="上传图片" hidefocus="true" nc_type="change_site_logo" title="点击前方预览图可查看大图，点击按钮选择文件并提交表单后上传生效" /></span></div></dd></td></tr>';


       $("#tbodytr>tr:eq("+leng+")").after(html) ;
       $("#tableid>tbody>tr:eq("+leng+")").after(html1) ;
       $("#tableid1>tbody>tr:eq("+leng+")").after(html2);
       item++;
     })
    function img_call_back(fileurl_tmp)
    {  
        $("#imagetext").val(fileurl_tmp);
        $("#img_as").attr('href', fileurl_tmp);
        $("#img_is").attr('onmouseover', "layer.tips('<img src="+fileurl_tmp+">',this,{tips: [1, '#fff']});");
    }

    function yu(item){
        var index=item;
         var leng1= $("#tbodytr").children("tr").length;
          if(leng1>1){
              $("#right"+index).remove();
              $("#mid"+index).remove();
              $("#left"+index).remove();
          }
      }


     function img_call_back_index(fileurl_tmp,item)
    {  
        $("#imagetext"+item).val(fileurl_tmp);
        $("#img_as"+item).attr('href', fileurl_tmp);
        $("#img_is"+item).attr('onmouseover', "layer.tips('<img src="+fileurl_tmp+">',this,{tips: [1, '#fff']});");
    }
	function clear_arr_trim(array) {
      for(var i = 0 ;i<array.length;i++){
          if(array[i] == "" || typeof(array[i]) == "undefined")
          {
              array.splice(i,1);
              i= i-1;
          }
      }
      return array;
  }
</script>
</body>
</html>