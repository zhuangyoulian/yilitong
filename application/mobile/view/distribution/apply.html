<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" href="__MOBILE__/css/distribution.css">
		<script src="__MOBILE__/js/screenAdaptation.js"></script>
		<style type="text/css">
			html{
				font-size: 62.5%;
			}
			.apply{
				width: 100%;
				height: 23.5rem;
				background-image: url(__MOBILE__/images/pic_bg.png);
				background-repeat: no-repeat;
				font-size: 0.3rem;
				background-size: 100% 100%;
			}
			header{
				height: 0.6rem;
				line-height: 0.55rem;
				display: flex;
				justify-content: center;
			}
			.title{
				color: #fff;
				font-size: 0.32rem;
				margin-left: 0.8rem;
			}
			header .title em{
				font-size: 0.5rem;
				position: relative;
				top: -0.1rem;
				margin: 0 0.08rem;
				font-style: normal;
			}
			section{
				height: 11rem;
				position: relative;
			}
			.introduce{
				background: #fff;
				height: 0.65rem;
				width: 6.1rem;
				border-radius: 0.3rem;
				position: absolute;
				top: 1.8rem;
				left: 10%;
				font-size: 0.28rem;
				color: #ff9d10;
			}
			.introduce>div:nth-child(2n-1){
			    float: left;
				margin: 0 0.35rem 0 0.38rem;
				height: 0.65rem;
				line-height: 0.65rem;
			}
			.introduce>div:nth-child(2n){
				float: left;
				border-right: 1px solid #ff9d10;
				height: 0.22rem;
				position: relative;
				top: 0.2rem;
			}
			.code{
				width: 4.5rem;
				position: absolute;
				top: 6.5rem;
				left: 20%;
			}
			.invite_code{
				width: 4.48rem;
				height: 0.96rem;
				line-height: 0.9rem;
				border: 0.04rem solid #fff;
				box-sizing: border-box;
				border-radius: 0.48rem;		
				color: #fff;font-size: 0.32rem;
			}
			.invite_code label{
				padding: 0 0.3rem;
			}
			.invite_code input{
				height: 0.7rem;
				width: 55%;
				font-size: 0.32rem;
				background: none;   
				border: 0;
				color: #fff;
				font-weight: bold;
                position: relative;
    			top: -0.02rem;
			}
			input::-webkit-input-placeholder{
				color: #ffce9d;
				font-weight: 100;
			}
			.btn{
				background:url(__MOBILE__/images/button_click.png);
				background-size: 4.5rem 0.96rem;
				height: 0.96rem;
				width: 4.5rem;
				font-size: 0.36rem;
				line-height: 0.96rem;
				text-align: center;
				color: #fff;
				margin-top: 0.44rem;
			}
			.auto_code{
				text-align: center;
				color: #fff;
				margin-top: 0.34rem;
				letter-spacing: 0.05rem;
				width: 2.2rem;
				position: absolute;
				left: 25%;
				border-bottom: 1px solid #fff;
				padding-bottom: 0.05rem;
			}
			footer{
				position: relative;
			}
			.distrobution{
				width: 6.7rem;
				position: absolute;
				left: 5.5%;
				top: 0.6rem;
			}
			.dis_title{
				text-align: center;
				color: #544fcb;
				font-size: 0.4rem;
				font-weight: bold;
			}
			.distxt{
				font-size: 0.3rem;
				padding: 0 0.3rem;
				letter-spacing: 0.02rem;
				line-height: 0.45rem;
             	padding-top: 0.3rem;
			}
         	.distxt p{
              padding: 0.1rem 0;
          	}
			.distxt em{
				color: #544fcb;
				font-weight: bold;
				font-style: normal;
			}
			.shopkeeper{
				width: 6.7rem;
				position: absolute;
				left: 5.5%;
				top: 5.4rem;
			}
			.sho_title{
				text-align: center;
				color: #e4202b;
				font-size: 0.4rem;
				font-weight: bold;
			}
			.box{
				padding: 0.3rem 0;
				height: 0.55rem;
                position: relative;
    			top: -0.3rem;
			}
			.number{
				width: 0.4rem;
				height: 0.4rem;
				background: #e4202b;
				border-radius: 50%;
				text-align: center;
				line-height: 0.4rem;
				margin-top: 0.05rem;
				color: #fff;
			}
			.box>div{
				float: left;
			}
			.shotxt{
				width: 5.2rem;
				margin-left: 0.325rem;
			}
			.black_bg{
				height: 100%;width: 100%;
				position: fixed;
				top: 0; left: 0;
				background: rgba(0,0,0,0.8);
				z-index: 9;
			}
			.tips{
				position: relative;
			}
			.tips img{
				position: absolute;
			}
			.jiantou{
				top: 0.2rem;
				right: 0.5rem;
				width: 1.4rem;
				height: 1.28rem;
			}
			.closes{
				position: relative;
				top: 1.5rem;
				left: 22%;
			}
			.closes img:nth-child(1){
				width: 1rem;
				height: 1.2rem;
			}
			.closes img:nth-child(2){
				left: 1.3rem;
				width: 2.4rem;
				height: 0.35rem;
			}.closes img:nth-child(3){
				left: 1.5rem;
				top: 0.5rem;
				width: 1.9rem;
				height: 0.88rem;
			}
			.back{
				position: absolute;
			    left: 0.2rem;
			    top: 0.12rem;
			}
			.back img{
				width: 0.6rem;
    			height: 0.6rem;
			}
          	.header_title{
				margin-top: 0.06rem;
			}
		</style>
	</head>
	<body> 
		<!-- 上一页的地址 -->
		<input type="hidden" id="url" value="{$url}">  
		<div class="apply">
			<!-- <if condition="$http  eq 1">
				<div class="black_bg">
					<div class="tips">
						<img class="jiantou" src="__MOBILE__/images/pic_arrow.png" >
						<div class="closes">
							<img src="__MOBILE__/images/pic_mascot.png" >
							<img src="__MOBILE__/images/icon_text.png" >
							<img src="__MOBILE__/images/icon_button.png" >
						</div>
					</div>
				</div>
			</if> -->
			
			<header>
				<div class="title">
					<div class="back">
						<if condition="$storeIndex eq -1">
		                    <a href="{:Url('/Mobile/Index/index')}">
		                <else/>
		                    <a href="javascript:history.back(-1)">
		                </if>
							<img src="__MOBILE__/images/icon_back_white.png">
							</a>
					</div>
					<div>
						一礼通 <em>.</em> 分销商城
					</div>
				</div>
			</header>
			<section>
				<div class="introduce">
					<div>零投入</div><div></div><div>零风险</div><div></div><div>购买商品赚佣金</div>
				</div>
				<div class="code">
					<if condition="empty($_SESSION['l_code'])">
						<div class="invite_code">
							<label>邀请码</label>
							<input type="text"  placeholder="请输入邀请码" id="code"/>
						</div>
					<else/>
						<div class="invite_code">
							<label>邀请码</label>
							<input type="text"  placeholder="请输入邀请码" value="{$_SESSION['l_code']}" id="code"/>
						</div>
					</if> 

					<div class="btn"  onclick="submit()">
						点击成为店主
					</div>
					<div class="auto_code">
						<a>我没有邀请码</a>
					</div>
				</div>
			</section>
			<div class="win2">
				<div class="win2wrap">
					<div class="win2box">
						<div class="reminder">系统将为您自动生成邀请码</div>
						<div class="choice">
							<div class="no">取消</div>
							<div class="cancel">确定</div>
						</div>
					</div>
				</div>
			</div>
			<footer>
				<div class="distrobution">
					<div class="dis_title">
						分销商城
					</div>
					<div class="distxt">
						<p>一礼通分销商城是<em>优质商品、自购省钱、礼店主赚钱</em>的社交电商平台。</p>
						<p>礼店主可通过多种方式赚取平台的佣金。</p>
					</div>
				</div>
				<div class="shopkeeper">
					<div class="sho_title">
						礼店主福利
					</div>
					<div class="distxt">
						<div class="box">
							<div class="number">1</div>
							<div class="shotxt">礼店主购买或推荐好友购买商品，该礼店主可获得商品的佣金。</div>
						</div>
						<div class="box">
							<div class="number">2</div>
							<div class="shotxt">推荐好友成为礼店主，该礼店主可获得好友产生订单的佣金。</div>
						</div>
						<div class="box">
							<div class="number">3</div>
							<div class="shotxt">礼店主推荐的3个或以上礼店主均产生订单时，该礼店主可额外获得平台的奖励金。</div>
						</div>
					</div>
				</div>
			</footer>
		</div>
	</body>
	<script src="__MOBILE__/js/jquery-1.11.3.min.js"></script>
	<script src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js "></script>
<script>

    //通过config接口注入权限验证配置
     // alert(location.href.split('#')[0]);
    wx.config({

        //debug : true,
        debug : false, 
        appId: '<?php echo $signPackage["appId"];?>',// 
        timestamp: '<?php echo $signPackage["timestamp"];?>',//生成签名的时间戳
        nonceStr: '<?php echo $signPackage["nonceStr"];?>',//生成签名的随机串
        signature: '<?php echo $signPackage["signature"];?>',

      jsApiList : ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo']

    });

    wx.ready(function(){

      var
                s_title = '我在礼店主赚了好多零花钱，给你分享一个赚钱小秘诀！',  // 分享标题

                s_link = 'https://www.yilitong.com/mobile/Distribution/phoneAuthfx/referrer_id/{$_SESSION['user']['user_id']}',  // 分享链接

                s_desc = '自用省钱，分享赚钱！史上最赚钱的礼店主来了~快!给你争取了一个名额！',  //分享描述

                s_imgUrl = 'http://www.yilitong.com/public/static/mobile/images/logo2.png'; 	// 分享图标

      //朋友圈

      wx.onMenuShareTimeline({

        title: s_title, // 分享标题

        link: s_link, // 分享链接

        imgUrl: s_imgUrl, // 分享图标

        success: function () { },

        cancel: function () { }

      });

      //发送给好友

      wx.onMenuShareAppMessage({

        title: s_title, // 分享标题

        desc: s_desc, // 分享描述

        link: s_link, // 分享链接

        imgUrl: s_imgUrl, // 分享图标

        type: '', // 分享类型,music、video或link，不填默认为link

        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空

        success: function () {},

        cancel: function () {}

      });

      //QQ好友

      wx.onMenuShareQQ({

        title: s_title, // 分享标题

        desc: s_desc, // 分享描述

        link: s_link, // 分享链接

        imgUrl: s_imgUrl, // 分享图标

        success: function () { },

        cancel: function () { }

      });

      //腾讯微博

      wx.onMenuShareWeibo({

        title: s_title, // 分享标题

        desc: s_desc, // 分享描述

        link: s_link, // 分享链接

        imgUrl: s_imgUrl, // 分享图标

        success: function () { },

        cancel: function () { }

      });

    });

</script>		
	<script type="text/javascript">
		// var closes = document.querySelector('.black_bg');
		// closes.onclick = function(){
		// 	closes.style.display = "none";
		// }
		$(".auto_code").click(function(){
		$('.win2').show();
		})
		$(".no").click(function(){
			$('.win2').hide();
		})
		$(".cancel").click(function(){
			$.ajax({
				type:'POST',
				url:"{:Url('Distribution/apply')}",
				data:{self:1},
				dataType: 'json',
				success: function(data){
					if(data.status == 2){
			          alert(data.msg);
			          window.location.reload();  //刷新当前页面
				   }
				}
			})
			$('.win2').hide();
		})
		function submit(){
			var code=$("#code").val();
			var url=$("#url").val();   //上一页的地址
			// console.log(url);
			$.ajax({
				type:'POST',
				url:"{:Url('Distribution/apply')}",
				data:{code:code},
				dataType: 'json',
				success: function(data){
			        if(data.status == 1){
			       		if (url !='') {
			          		alert('恭喜您成为店主！将为您跳转页面。');
					  		location.href = url;
			       		}else{
			          		alert(data.msg);
					  		location.href = '/Mobile/Distribution/index/id/'+data.id+'.html';
			       		}
				   }else{
			           alert(data.msg);
				   }
				}
			})
		}
	</script>
</html>
