<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>登录-{$config['shop_info_store_title']}</title>
    <meta http-equiv="keywords" content="{config['shop_info_store_keyword']}" />
    <meta name="description" content="{$config['shop_info_store_desc']}" />
    <link rel="stylesheet" href="__STATIC__/css/index.css" type="text/css">
    <script src="__PUBLIC__/js/jquery-1.10.2.min.js"></script>
    <script src="__STATIC__/js/slider.js"></script>
    <script type="text/javascript" src="__PUBLIC__/static/js/layer/layer.js"></script>
    <style>
        table tr td.pa-to-30{padding-top:25px;}
        .wel-log h3{padding-top:0;}
        .wel-log h3 span{font-size:16px;margin-left:20px;margin-bottom:10px;}
        .login{width:274px;}
        .to0{top:6px;}
        .wi96{margin-right:18px;}

        /*wrp css*/

        .footer_quality{overflow: hidden;}
        .footer_quality li{float: left;}
        .logo-businessCenter{
            overflow: hidden;
            float: left;
        }
        /* wrp add css */
        .logo-businessCenter li{float: left; margin-top:20px;}
        .logo-businessCenter li.logo-businessCenter-li1{padding-right: 20px;}
        .logo-businessCenter li.logo-businessCenter-li2{line-height:60px; padding-left:30px; font-size:18px; border-left:1px solid #ccc;}

        .regs-info{ overflow: hidden; float: right; line-height: 100px; font-size: 12px;}
        .regs-info li{ float: left; padding: 0 10px; font-weight: bold;}
        .regs-info li a{ font-weight: normal;}
        .regs-info li a:hover{ color: #ff0000;}


        .pa-10-0 tr td{line-height:32px;}
        /*.zc-text{float: left;}*/

        /* 第三方登录 */
        .third-login ul{
            overflow:hidden;
            height:40px;
        }
        .third-login ul li{
            float:left;

        }
        .third-login ul li.reging-now{
            float:right;
        }
        .third-login ul li.reging-now>a{
            line-height:28px;
            font-size:14px;
            font-weight:bold;
            color:#ff7333;
        }
        .third-login ul li.reging-now>a:hover{
            text-decoration:underline;
        }


        /* 会员登录 底部样式 */
        .leaguer-footer{
            text-align:center;
        }
        .footer-menu-list{
            overflow:hidden;
            width:650px;
            margin:50px auto 20px auto;
        }
        .footer-menu-list li{
            float:left;
            padding: 0 5px;
            border-right:1px solid #999;
        }
        .footer-menu-list li a{
            color:#888;
        }
        .footer-menu-list li a:hover{
            color:#e6002d;
        }
        .footer-menu-list li:last-of-type{
            border-right:0;
        }
        .leaguer-footer p{
            color:#888;
        }

        .fo-fa-ta:hover{
            color: #e6002d;
        }
        
        /* 新增css */
        #hz_mima{
            margin-left: 30px;
            cursor: pointer;
        }
        #hz_duanxin{
            margin-right: 30px;
            cursor: pointer;
        }   
        .wel-log span.active{
            color: #e50012;
        }
        .hidden{
            display:none;
        }
        .po-re2{
            position: relative;
        }
        .fasong_code{
            position: absolute;
            right: 0px;
            top: 50%;
            width: 75px;
            height:34px;
            font-size: 9px;
            border:1px solid #f5f5f5;
            text-align: center;
            margin-top: -17px;
            cursor: pointer;
        }
        .fasong_code.disab{
            pointer-events: none;
        }
        .wrapp2{
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            right: 0px;
            bottom: 0px;
            background:rgba(0,0,0,1);
            opacity:0.5;
            z-index: 4000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .wrapp2.hidden{
            display: none;
        }
        #tanchunag2{
            opacity: 1;
            width:360px;
            height:316px;
            background:#FFFFFF;
            z-index: 5000;
            position: absolute;
            left: calc(50% - 180px);
            top:calc(50% - 158px);
            /* display: flex; */
            
        }
        #tanchunag2 .title_icon{
            display: flex;
            justify-content: space-between;
            margin-left: 20px;
            margin-right: 20px;
            height: 53px;
            align-items: center;
        }
        #tanchunag2 .inputf{
            margin-left: 36px;
            font-size: 14px;
            color: #333333;
            line-height: 34px;
        }
        #tanchunag2 .inputf input{
            width: 200px;
            height: 34px;
        }
        #tanchunag2 .inputf.in1{
            margin-top: 38px;
            margin-bottom: 26px;
        }
        #tanchunag2 .inputf.in2{
            margin-bottom: 42px;
        }
        #tanchunag2 .confirm-btn{
            width:280px;
            height:40px;
            background:rgba(5,156,255,1);
            text-align: center;
            line-height: 40px;
            color: #FFFFFF;
            font-size: 16px;
            margin: 0 auto;
        }
        #tanchunag2 .icon_close2x{
            width: 16px;
            height: 16px;
        }
        
    </style>
</head>

<body class="regs">
    <div class="wrapp2 hidden">
        
    </div>
    <div id="tanchunag2" class="hidden">
        <div class="title_icon">当前账号为首次登陆，请设置登陆密码<img src="__BUSINESS__/images/icon_close@2x.png" class="icon_close2x"></div>
        <hr>
        <div class="inputf in1">
            输入密码：<input type="text" name="ac_password" id="ac_password" value="" />
        </div>
        <div class="inputf in2">
            确认密码：<input type="text" name="ac_password2" id="ac_password2" value="" />
        </div>
        <div class="confirm-btn" onClick="ac_password()" >确认</div>
    </div>
        
<div class="customer-header" style="height:100px;line-height:100px;">
    <div class="wrap">
        <div class="simplelogo" style="overflow: hidden;">
            <ul class="logo-businessCenter">
                <li class="logo-businessCenter-li1"><a href="/"><img src="__BUSINESS__/images/regLogo.png" alt="logo" style=""></a></li>
                <li class="logo-businessCenter-li2">账号登录</li>
            </ul>
        </div>
    </div>
</div>
<hr style="box-shadow: 0 1px 2px #ccc;">

<!-- login content -->
<div class="login-wrap user_login926_bg">
    <div class="setout w">
        <div class="login-area">
            <div class="leaguer-login-bg" style=""></div>
            <!--<div class="user_login">-->
            <div style="width:380px;margin-left:100px; background:#ffffff;float:left;margin-top:30px;">
                <div class="wel-log" style="border-bottom:1px solid #ccc; padding:20px 30px 10px 30px; font-size:18px;">
                    <span id="hz_duanxin"  class="active">短信登录</span>|<span id="hz_mima">密码登录</span>
                </div>
                
                <div style=" padding:10px 30px" id="login1"  class="hidden">
                    <!-- <form action="{:Url('Home/Business/login')}" method="post"> -->
                        <input type="hidden" name="login_type" value="1">
                        <input type="hidden" name="referurl" id="referurl" value="{$referurl}">
                        <div class="login-x">
                            <div class="x">
                                <div class="ma-to--26">
                                    <table class="pa-10-0" width="100%" border="0" cellspacing="0" cellpadding="0">

                                        <tr>
                                            <td>
                                                账&nbsp;号：
                                                <input class="zc-text" type="text" id="mobile" name="mobile" placeholder="手机号" maxlength="11"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                密&nbsp;码：
                                                <input class="zc-text" name="password" id="password" type="password" placeholder="请输入密码"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="po-re">
                                                <span style="float:left;">验证码：</span>
                                                <input class="zc-text wi96" type="text" name="verify_code" id="verify_code" placeholder="不区分大小写"/>
                                                <img class="po-ab to0" id="verify_code_img" style="margin-left:-12px; margin-top:4px;" width="100" height="32" src="{:Url('Home/User/verify')}"  onclick="verify(this)" />

                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <a class="fo-fa-ta co929292" href="{:Url('Home/user/forget_pwd')}" title="忘记密码？">忘记密码？</a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <input type="hidden" name="type" value="save"/>
                                                <input type="button" class="login" style="width:285px; background-color:#059ce1;" onClick="checkSubmit()" value="登录">
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <!-- </form> -->
                    <!-- 第三方登录 && 立即注册-->
                    <style>

                    </style>

                    <div class="third-login" style="padding:10px 30px;">
                        <ul>
                            <li>
                                <a href="{:Url('LoginApi/login',array('oauth'=>'qq'))}" title="QQ登录">
                                    <img src="__STATIC__/img/QQ.png"/>
                                </a>
                            </li>
                            <li>
                                <a href="{:Url('LoginApi/login',array('oauth'=>'weixin'))}" title="微信登录">
                                    <img src="__STATIC__/img/weixin.png"/>
                                </a>
                            </li>
                            <li class="reging-now">
                                <a href="{:Url('Home/User/register')}" title="立即注册">立即注册</a>
                            </li>
                        </ul>

                    </div>
                </div>
                <div style=" padding:10px 30px" id="login2">
                    <!-- <form action="{:Url('Home/Business/login')}" method="post"> -->
                        <input type="hidden" name="login_type" value="2">
                        <div class="login-x">
                            <div class="x">
                                <div class="ma-to--26">
                                    <table class="pa-10-0" width="100%" border="0" cellspacing="0" cellpadding="0">
                
                                        <tr>
                                            <td>
                                                手&nbsp;&nbsp;机&nbsp;&nbsp;号：
                                                <input class="zc-text" type="text"  name="mobile2" placeholder="手机号" id="mobile2" maxlength="11"/>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="po-re">
                                                验&nbsp;&nbsp;证&nbsp;&nbsp;码：
                                                <input class="zc-text wi96" type="text" name="verify_code2" id="verify_code2" placeholder="不区分大小写"/>
                                                <img class="po-ab to0" id="verify_code_img2" style="margin-left:-12px; margin-top:4px;" width="100" height="32" src="{:Url('Home/User/verify')}"  onclick="verify2(this)" />
                                            </td>
                                        </tr>
                                       <tr>
                                           <td class="po-re po-re2">
                                               <span style="float:left;">短信验证码：</span>
                                               <input class="zc-text wi96" type="text" name="mobile_code" id="mobile_code"/>
                                               <div class="fasong_code">发送验证码</div>
                                           </td>
                                       </tr>
                                        <tr>
                                            <td>
                                                <a class="fo-fa-ta co929292" href="{:Url('Home/user/forget_pwd')}" title="忘记密码？">忘记密码？</a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <input type="hidden" name="type" value="save"/>
                                                <input type="button" class="login" style="width:285px; background-color:#059ce1;" onClick="checkSubmit()" value="登录">
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    <!-- </form> -->
                    <!-- 第三方登录 && 立即注册-->
                    <style>
                
                    </style>
                
                    <div class="third-login" style="padding:10px 30px;">
                        <ul>
                            <li>
                                <a href="{:Url('LoginApi/login',array('oauth'=>'qq'))}" title="QQ登录">
                                    <img src="__STATIC__/img/QQ.png"/>
                                </a>
                            </li>
                            <li>
                                <a href="{:Url('LoginApi/login',array('oauth'=>'weixin'))}" title="微信登录">
                                    <img src="__STATIC__/img/weixin.png"/>
                                </a>
                            </li>
                            <li class="reging-now">
                                <a href="{:Url('Home/User/register')}" title="立即注册">立即注册</a>
                            </li>
                        </ul>
                
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--</div>-->
<!-- 底部 -->
<hr style="box-shadow: 0 1px 2px #ccc;">
<div class="leaguer-footer">
    <ul class="footer-menu-list">
        <li><a href="#">关于一礼通</a></li>
        <li><a href="#">我们的团队</a></li>
        <li><a href="#">网站联盟</a></li>
        <li><a href="#">热门搜索</a></li>
        <li><a href="#">诚征英才</a></li>
        <li><a href="#">友情链接</a></li>
        <li><a href="#">一礼通新品</a></li>
        <li><a href="#">开放平台</a></li>
        <li><a href="#">深圳礼至礼品有限公司</a></li>
    </ul>
    <p>Copyright&nbsp;© 2017-2027 {$config['shop_info_store_name']}&nbsp;版权所有&nbsp;保留一切权利&nbsp;备案号:{$config['shop_info_record_no']}</p>
</div>


<!-- 新增js -->
<script>
    $(function(){
        $('#hz_mima').click(function(){
            $('#login1').removeClass('hidden');
            $('#login2').addClass('hidden');
            $('#hz_mima').addClass('active');
            $('#hz_duanxin').removeClass('active');
        })
        $('#hz_duanxin').click(function(){
            $('#login2').removeClass('hidden');
            $('#login1').addClass('hidden');
            $('#hz_duanxin').addClass('active');
            $('#hz_mima').removeClass('active');
        })
        
        $('.fasong_code').click(function(){
            if(codeBtn.waitingCode){
                var verify_code = $('#verify_code2').val();
                var mobile = $('#mobile2').val();
                var url = "/index.php?m=Home&c=Api&a=send_validate_code&scene=2&type=5&mobile="+mobile+"&verify_code="+verify_code;
                $.get(url,(res)=>{
                    if(res.status == 1)
                    {                         
                        NumCode();
                        $('.fasong_code').removeClass('disab');
                    }else{
                        alert(res.msg);
                    }
                })
            }else{
                $('.fasong_code').addClass('disab');
            }
        });
        var codeBtn={
            waitingCode:true,
            count:60,
            text:60+'s'
        }
        function NumCode(){
            let countdown = setInterval( () => {
                codeBtn.count--;
                codeBtn.text = codeBtn.count + 's';
                codeBtn.waitingCode=false;
                $('.fasong_code').html(codeBtn.text);
                if(codeBtn.count < 0 ){
                    codeBtn.count=60;
                    clearInterval(countdown);
                    codeBtn.text = '重新发送';
                    codeBtn.waitingCode = true;
                    $('.fasong_code').html(codeBtn.text);
                }
            },1000);
    
        }
        
    });
    
    
</script>


<script>
    function verify(){
       $('#verify_code_img').attr('src',"/index.php?m=Home&c=User&a=verify&r="+Math.random());
    }

    function verify2(){
       $('#verify_code_img2').attr('src',"/index.php?m=Home&c=User&a=verify&r="+Math.random());
    }
    
    function checkSubmit()
    {
        var mobile = $('#mobile').val();
        var mobile2 = $('#mobile2').val();
        var password = $('#password').val();
        var referurl = $('#referurl').val();
        var verify_code = $('#verify_code').val();
        var mobile_code = $('#mobile_code').val();
        var login_type = $("input[name='login_type']").val();
        if (login_type == 2) {
            if(mobile == ''){
                layer.alert('用户名不能为空', {icon: 2});
                return false;
            }
            if(!checkMobile(mobile) && !checkEmail(mobile)){
                layer.alert('账号格式不匹配!', {icon: 2});
                return false;
            }
            if(password == ''){
                layer.alert('密码不能为空!', {icon: 2});
                return false;
            }
        }

        $.ajax({
            type : 'post',
            url : '/index.php?m=Home&c=User&a=login&t='+Math.random(),
            data : {mobile:mobile,mobile2:mobile2,password:password,referurl:referurl,verify_code:verify_code,mobile_code:mobile_code},
            dataType : 'json',
            success : function(res){
                if(res.status == 1){
                    console.log(res);
                    window.location.href = res.url;
                    return false; 
                }else if(res.status == 2){
                    $('#tanchunag2').removeClass('hidden');
                }else{
                    layer.alert(res.msg, {icon: 2});
                    verify();
                }
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
            layer.alert('网络失败，请刷新页面后重试', {icon: 2});
            }
        })

    }

    /**
     * [ac_password 项目用户设置密码]
     * @return {[type]} [description]
     */
    function ac_password(){
        var mobile = $('#mobile2').val();
        var ac_password = $('#ac_password').val();
        var ac_password2 = $('#ac_password2').val();
        if(ac_password == ''){
            layer.alert('密码不能为空!', {icon: 2});
            return false;
        }
        if(ac_password != ac_password2){
            layer.alert('两次密码不一致!', {icon: 2});
            return false;
        }
        $.ajax({
            type : 'post',
            url  : "/index.php?m=Home&c=User&a=ac_up_pw&mobile="+mobile+"&ac_password="+ac_password,
            dataType : 'json',
            success : function(res){
                if(res.status == 1){
                    layer.alert(res.msg, {icon: 1});
                    window.location.href = "/";
                    return false; 
                }else{
                    layer.alert(res.msg, {icon: 2});
                    return false; 
                }
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
            layer.alert('网络失败，请刷新页面后重试', {icon: 2});
            }
        })
    }

    //直接按回车登录
    document.onkeydown = function(e){
        var ev = document.all ? window.event : e;
        if(ev.keyCode==13) {
            checkSubmit();
        }
    };
    
    function checkMobile(tel) {
        var reg = /(^1[3|4|5|6|7|8|9][0-9]{9}$)/;
        if (reg.test(tel)) {
            return true;
        }else{
            return false;
        };
    }
    
    function checkEmail(str){
        var reg = /^[a-z0-9]([a-z0-9\\.]*[-_]{0,4}?[a-z0-9-_\\.]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+([\.][\w_-]+){1,5}$/i;
        if(reg.test(str)){
            return true;
        }else{
            return false;
        }
    }
    

    
</script>
<script>
    $(function(){  
 
  //判断浏览器是否支持placeholder属性
  supportPlaceholder='placeholder'in document.createElement('input'),
 
  placeholder=function(input){
 
    var text = input.attr('placeholder'),
    defaultValue = input.defaultValue;
 
    if(!defaultValue){
 
      input.val(text).addClass("phcolor");
    }
 
    input.focus(function(){
 
      if(input.val() == text){
   
        $(this).val("");
      }
    });
 
  
    input.blur(function(){
 
      if(input.val() == ""){
       
        $(this).val(text).addClass("phcolor");
      }
    });
 
    //输入的字符不为灰色
    input.keydown(function(){
  
      $(this).removeClass("phcolor");
    });
  };
 
  //当浏览器不支持placeholder属性时，调用placeholder函数
  if(!supportPlaceholder){
 
    $('input').each(function(){
 
      text = $(this).attr("placeholder");
 
      if($(this).attr("type") == "text"){
 
        placeholder($(this));
      }
    });
  }
 
});
</script>
</body>
</html>